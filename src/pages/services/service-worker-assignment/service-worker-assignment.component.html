<div class="container">
  <h2>Назначение мастеров услугам</h2>

  <div *ngIf="isLoading" class="loading">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>

  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
    <mat-nested-tree-node *matTreeNodeDef="let node; when: isServiceNode">
      <div
        class="mat-tree-node service-node bordered"
        matTreeNodeToggle
        (click)="onServiceNodeToggle(node)"
      >
        <mat-icon class="tree-toggle-icon">
          {{ treeControl.isExpanded(node) ? "expand_more" : "chevron_right" }}
        </mat-icon>
        <span class="node-name service-text">{{ node.name }}</span>
        <span class="spacer"></span>
        <button
          mat-stroked-button
          color="accent"
          class="update-workers-button"
          (click)="openAssignmentModal(node.rawService); $event.stopPropagation()"
        >
          Обновить мастеров
        </button>
      </div>
      <div [class.tree-invisible]="!treeControl.isExpanded(node)" role="group">
        <ng-container matTreeNodeOutlet></ng-container>
      </div>
    </mat-nested-tree-node>

    <mat-tree-node *matTreeNodeDef="let worker">
      <div class="mat-tree-node worker-node bordered">
        <span class="node-name worker-text">{{ worker.name }}</span>
      </div>
    </mat-tree-node>
  </mat-tree>
</div>
